{% extends "FulldonIntersaBundle::coque_intersa.html.twig" %}
    {% block stylesheets %}
        {{ parent() }}
        <style>
            label {
                font-size: 12px !important;
                font-weight: bold !important;
                padding: 2px !important;
                margin: 0 !important;
            }
        </style>
    {% endblock %}
    {% block coque_intersa %}
        <div class="breadcrumbs" id="breadcrumbs">
            <ol class="breadcrumb">
                <li><a href="{{ path('fulldon_intersa_homepage') }}">Accueil</a></li>
                <li class="active">Gestion des dons</li>
            </ol>
        </div>
        <div class="page-content">

        <div class="col-md-12">
        <div class="page-header">
            <h1>
                Gestion des dons
                <small>
                    <i class="ace-icon fa fa-angle-double-right"></i>
                    Recherche avancée
                </small>
            </h1>
        </div>
        <!-- /.page-header -->

        {% for flashMessage in app.session.flashbag.get('info') %}
            <div class="alert alert-success">
                {{ flashMessage }}
            </div>
        {% endfor %}
        {% for flashMessage in app.session.flashbag.get('warning') %}
            <div class="alert alert-warning">
                {{ flashMessage }}
            </div>
        {% endfor %}
        <div class="pull-right">
            {% if last_page >= 1 %}
                <div class="pagination_desc"><strong>{{ total_dons }}</strong> Don(s)

                </div>
            {% endif %}
        </div>
        {% if is_granted('ROLE_INTERSA_N1') or is_granted('ROLE_ASSOC_N1') or is_granted('ROLE_TRIAL') %}

            <div class="btn-group " style="margin-right: 20px;">
                <button type="button" class="btn btn-warning dropdown-toggle btn-sm" data-toggle="dropdown"
                        aria-expanded="false">
                    <i class="fa fa-star"></i> Gestion des favoris <i
                            class="ace-icon fa fa-angle-down icon-on-right"></i>
                </button>
                <ul class="dropdown-menu" role="menu">
                    {% if result is not empty %}
                        <li><a data-toggle="modal" data-target="#addRecherche" href="#"><i class="fa fa-plus"></i>
                                Ajouter cette recherche aux favoris</a></li>
                    {% endif %}
                    <li><a data-toggle="modal" data-target="#listRecherche" href="#"><i class="fa fa-list"></i> Afficher
                            les recherches favorites</a></li>

                    {#<li><a href="#"><i class="fa fa-file-excel-o"></i> Export excel</a></li>#}
                    {#<li><a href="#"><i class="fa fa-file-pdf-o"></i> Export pdf</a></li>#}

                </ul>
            </div>
            {% if result is not empty %}
                <div class="btn-group">
                    <button type="button" class="btn btn-warning btn-sm dropdown-toggle" data-toggle="dropdown"
                            aria-expanded="false">
                        <i class="fa fa-download"></i> Exporter le résultat <i
                                class="ace-icon fa fa-angle-down icon-on-right"></i>
                    </button>
                    <ul class="dropdown-menu  dropdown-menu-right" role="menu">
                        <li><a href="{{ path('intersa_donateur_export_fromdon') }}?{{ params }}"><i
                                        class="fa fa-file-archive-o"></i> Exporter les donateurs et les dons </a></li>
                    </ul>
                </div>
            {% endif %}

        {% endif %}
        <hr/>
        <ul class="nav nav-tabs">
            <li {% if result is  empty %}class="active"{% endif %} ><a href="#recherche" data-toggle="tab">Recherche</a>
            </li>
            <li {% if result is not empty %}class="active"{% endif %}><a href="#result" data-toggle="tab">Resultat de
                    recherche</a></li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">
        <div class="tab-pane {% if result is  empty %}active{% endif %}" id="recherche">
        <br/>

        <form action="{{ path('intersa_dons') }}" method="get" class="form-group" onsubmit="show_result()">
        <div class="widget-toolbox padding-8 clearfix">


            <button class="btn btn-xs btn-success pull-right" type="submit">
                <span class="bigger-110">Rechercher</span>

                <i class="ace-icon fa fa-search icon-on-right"></i>
            </button>
        </div>
        <div class="row">
        <div class="col-xs-12 col-sm-4">
            <div class="widget-box">
                <div class="widget-header">
                    <h4 class="widget-title title-plus">Références</h4>

                </div>

                <div class="widget-body">
                    <div class="widget-main">
                        <div>
                            <label for="iban"><label for="iban" class="required">N° de transaction</label></label>
                            {% if  app.session.flashbag.has('error_id_don') %}
                                {# Affichage des erreurs pour ce champ précis. #}
                                <div class="form-group has-error">
                                    <label class="control-label" for="inputError">
                                        {% for flashMessage in app.session.flashbag.get('error_id_don') %}
                                            <li>{{ flashMessage }}</li>
                                        {% endfor %}
                                    </label>
                                    <input type="text" id="id_don"
                                           name="id_don" {% if memo_search['id_don'] is defined and memo_search['id_don'] is not null %} value="{{ memo_search['id_don'] }}" {% endif %}
                                           placeholder="Identifiant du don" class="task_field form-control ">
                                </div>
                            {% else %}
                                <input type="text" id="id_don"
                                       name="id_don" {% if memo_search['id_don'] is defined and memo_search['id_don'] is not null %} value="{{ memo_search['id_don'] }}" {% endif %}
                                       placeholder="Identifiant du don" class="task_field form-control ">
                            {% endif %}
                            <br/>
                        </div>
                        <div>

                            <label for="iban"><label for="iban" class="required">Code activité</label></label>
                            {% if  app.session.flashbag.has('error_code_activite') %}
                                {# Affichage des erreurs pour ce champ précis. #}
                                <div class="form-group has-error">
                                    <label class="control-label" for="inputError">
                                        {% for flashMessage in app.session.flashbag.get('error_code_activite') %}
                                            <li>{{ flashMessage }}</li>
                                        {% endfor %}
                                    </label>
                                    <input type="text" id="cause" autocomplete="off"
                                           name="cause" {% if memo_search['cause'] is defined and memo_search['cause'] is not null %} value="{{ memo_search['cause'] }}" {% endif %}
                                           placeholder="Code d'activité" class="task_field form-control ">
                                </div>
                            {% else %}
                                <input type="text" id="cause" autocomplete="off"
                                       name="cause" {% if memo_search['cause'] is defined and memo_search['cause'] is not null %} value="{{ memo_search['cause'] }}" {% endif %}
                                       placeholder="Code d'activité" class="task_field form-control ">
                            {% endif %}
                            <br/>
                        </div>

                        <div>

                            <label for="iban"><label for="iban" class="required">Code occasion</label></label>
                            {% if  app.session.flashbag.has('error_code_activite') %}
                                {# Affichage des erreurs pour ce champ précis. #}
                                <div class="form-group has-error">
                                    <label class="control-label" for="inputError">
                                        {% for flashMessage in app.session.flashbag.get('error_code_occasion') %}
                                            <li>{{ flashMessage }}</li>
                                        {% endfor %}
                                    </label>
                                    <input type="text" id="code_occasion" autocomplete="off"
                                           name="code_occasion" {% if memo_search['code_occasion'] is defined and memo_search['code_occasion'] is not null %} value="{{ memo_search['code_occasion'] }}" {% endif %}
                                           placeholder="Code Occasion" class="task_field form-control ">
                                </div>
                            {% else %}
                                <input type="text" id="code_occasion" autocomplete="off"
                                       name="code_occasion" {% if memo_search['code_occasion'] is defined and memo_search['code_occasion'] is not null %} value="{{ memo_search['code_occasion'] }}" {% endif %}
                                       placeholder="Code Occasion" class="task_field form-control ">
                            {% endif %}
                            <br/>
                        </div>

                        <div>

                            <label for="iban"><label for="iban" class="required">Code campagne</label></label>
                            {% if  app.session.flashbag.has('error_code_activite') %}
                                {# Affichage des erreurs pour ce champ précis. #}
                                <div class="form-group has-error">
                                    <label class="control-label" for="inputError">
                                        {% for flashMessage in app.session.flashbag.get('error_code_campagne') %}
                                            <li>{{ flashMessage }}</li>
                                        {% endfor %}
                                    </label>
                                    <input type="text" id="code_campagne" autocomplete="off"
                                           name="code_campagne" {% if memo_search['code_campagne'] is defined and memo_search['code_campagne'] is not null %} value="{{ memo_search['code_campagne'] }}" {% endif %}
                                           placeholder="Code campagne" class="task_field form-control ">
                                </div>
                            {% else %}
                                <input type="text" id="code_campagne" autocomplete="off"
                                       name="code_campagne" {% if memo_search['code_campagne'] is defined and memo_search['code_campagne'] is not null %} value="{{ memo_search['code_campagne'] }}" {% endif %}
                                       placeholder="Code campagne" class="task_field form-control ">
                            {% endif %}
                            <br/>
                        </div>

                        <div>
                            <label for="iban"><label for="iban" class="required">N° de reçu fiscal</label></label>
                            <input type="text" id="num_rf" name="num_rf" placeholder="Numéro de reçu fiscal"
                                   class="task_field form-control " {% if memo_search['num_rf'] is defined and memo_search['num_rf'] is not null %} value="{{ memo_search['num_rf'] }}" {% endif %} >
                            <br/>
                        </div>
                        <div>
                            <label for="iban"><label for="iban" class="required">N° Lot </label></label>
                            {% if  app.session.flashbag.has('error_lot_don') %}
                                {# Affichage des erreurs pour ce champ précis. #}
                                <div class="form-group has-error">
                                    <label class="control-label" for="inputError">
                                        {% for flashMessage in app.session.flashbag.get('error_lot_don') %}
                                            <li>{{ flashMessage }}</li>
                                        {% endfor %}
                                    </label>
                                    <input type="text" id="lot_don"
                                           name="lot_don" {% if memo_search['lot_don'] is defined and memo_search['lot_don'] is not null %} value="{{ memo_search['lot_don'] }}" {% endif %}
                                           placeholder="Lot " class="task_field form-control ">
                                </div>
                            {% else %}
                                <input type="text" id="lot_don"
                                       name="lot_don"   {% if memo_search['lot_don'] is defined and memo_search['lot_don'] is not null %} value="{{ memo_search['lot_don'] }}" {% endif %}
                                       placeholder="Lot" class="task_field form-control ">
                            {% endif %}
                            <br/>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.span -->

        <div class="col-xs-12 col-sm-4">
            <div class="widget-box">
                <div class="widget-header">
                    <h4 class="widget-title title-plus ">Don</h4>


                </div>

                <div class="widget-body">
                    <div class="widget-main">
                        <div>
                            <label for="iban"><label for="iban" class="required">Type de don</label></label>
                            <select name="type_don" class="task_field form-control ">
                                <option value=""></option>
                                <option value="ponctuel" {% if memo_search['type_don'] is defined and memo_search['type_don'] is not null and memo_search['type_don'] == 'ponctuel' %} selected="selected" {% endif %} >
                                    Don ponctuel
                                </option>
                                <option value="regulier" {% if memo_search['type_don'] is defined and memo_search['type_don'] is not null and memo_search['type_don'] == 'regulier' %} selected="selected" {% endif %}>
                                    Don réguilier
                                </option>
                            </select>
                            <br/>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="iban"><label for="iban" class="required">Intervalle de date</label></label>
                            </div>
                            <div class="col-md-6">
                                {% if  app.session.flashbag.has('error_date_debut') %}
                                    {# Affichage des erreurs pour ce champ précis. #}
                                    <div class="form-group has-error">
                                        <label class="control-label" for="inputError">
                                            {% for flashMessage in app.session.flashbag.get('error_date_fin') %}
                                                <li>{{ flashMessage }}</li>
                                            {% endfor %}
                                        </label>
                                        <input type="text" id="date_debut"
                                               name="date_debut" {% if memo_search['date_debut'] is defined and memo_search['date_debut'] is not null %} value="{{ memo_search['date_debut'] }}" {% endif %}
                                               placeholder="Date début jj/mm/aaaa"
                                               class=" datepicker task_field form-control ">
                                    </div>
                                {% else %}
                                    <input type="text" id="date_debut"
                                           name="date_debut"   {% if memo_search['date_debut'] is defined and memo_search['date_debut'] is not null %} value="{{ memo_search['date_debut'] }}" {% endif %}
                                           placeholder="Date début jj/mm/aaaa"
                                           class=" datepicker task_field form-control ">
                                {% endif %}
                            </div>
                            <div class="col-md-6">
                                {% if  app.session.flashbag.has('error_date_fin') %}
                                    {# Affichage des erreurs pour ce champ précis. #}
                                    <div class="form-group has-error">
                                        <label class="control-label" for="inputError">
                                            {% for flashMessage in app.session.flashbag.get('error_date_fin') %}
                                                <li>{{ flashMessage }}</li>
                                            {% endfor %}
                                        </label>
                                        <input type="text" id="date_fin"
                                               name="date_fin"  {% if memo_search['date_fin'] is defined and memo_search['date_fin'] is not null %} value="{{ memo_search['date_fin'] }}" {% endif %}
                                               placeholder="Date fin jj/mm/aaaa"
                                               class="datepicker task_field form-control ">
                                    </div>
                                {% else %}
                                    <input type="text" id="date_fin"
                                           name="date_fin"  {% if memo_search['date_fin'] is defined and memo_search['date_fin'] is not null %} value="{{ memo_search['date_fin'] }}" {% endif %}
                                           placeholder="Date fin jj/mm/aaaa"
                                           class="datepicker task_field form-control ">
                                {% endif %}
                            </div>
                        </div>
                        <br/>

                        <div class="row">
                            <div class=" col-md-12">
                                <div class="row">
                                    <div class="col-md-12">
                                        <label for="iban"><label for="iban" class="required">Intervalle de date d'arrêt
                                                d'engagement </label></label>
                                    </div>
                                    <div class="col-md-6">
                                        {% if  app.session.flashbag.has('error_stop_date_debut') %}
                                            {# Affichage des erreurs pour ce champ précis. #}
                                            <div class="form-group has-error">
                                                <label class="control-label" for="inputError">
                                                    {% for flashMessage in app.session.flashbag.get('error_stop_date_debut') %}
                                                        <li>{{ flashMessage }}</li>
                                                    {% endfor %}
                                                </label>
                                                <input type="text" id="date_stop_debut"
                                                       name="date_stop_debut"  {% if memo_search['date_stop_debut'] is defined and memo_search['date_stop_debut'] is not null %} value="{{ memo_search['date_stop_debut'] }}" {% endif %}
                                                       placeholder="Date début jj/mm/aaaa"
                                                       class=" datepicker task_field form-control ">
                                            </div>
                                        {% else %}
                                            <input type="text" id="date_stop_debut"
                                                   name="date_stop_debut"  {% if memo_search['date_stop_debut'] is defined and memo_search['date_stop_debut'] is not null %} value="{{ memo_search['date_stop_debut'] }}" {% endif %}
                                                   placeholder="Date début jj/mm/aaaa"
                                                   class=" datepicker task_field form-control ">
                                        {% endif %}
                                    </div>
                                    <div class="col-md-6">
                                        {% if  app.session.flashbag.has('error_stop_fin') %}
                                            {# Affichage des erreurs pour ce champ précis. #}
                                            <div class="form-group has-error">
                                                <label class="control-label" for="inputError">
                                                    {% for flashMessage in app.session.flashbag.get('error_stop_date_fin') %}
                                                        <li>{{ flashMessage }}</li>
                                                    {% endfor %}
                                                </label>
                                                <input type="text" id="date_stop_fin"
                                                       name="date_stop_fin"   {% if memo_search['date_stop_fin'] is defined and memo_search['date_stop_fin'] is not null %} value="{{ memo_search['date_stop_fin'] }}" {% endif %}
                                                       placeholder="Date fin jj/mm/aaaa"
                                                       class="datepicker task_field form-control ">
                                            </div>
                                        {% else %}
                                            <input type="text" id="date_stop_fin"
                                                   name="date_stop_fin"   {% if memo_search['date_stop_fin'] is defined and memo_search['date_stop_fin'] is not null %} value="{{ memo_search['date_stop_fin'] }}" {% endif %}
                                                   placeholder="Date fin jj/mm/aaaa"
                                                   class="datepicker task_field form-control ">
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="row">

                                </div>
                                <br/>

                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="iban"><label>Montant des dons</label></label>
                            </div>
                            <div class="col-md-6">
                                <select name="montant_choice" class="task_field form-control ">
                                    <option value="sup" {% if memo_search['montant_choice'] is defined and memo_search['montant_choice'] == "sup" %} selected {% endif %}>
                                        Supérieur ou égal à
                                    </option>
                                    <option value="inf" {% if memo_search['montant_choice'] is defined and memo_search['montant_choice'] == "inf" %} selected {% endif %}>
                                        Inférieur ou égal à
                                    </option>
                                    <option value="eq" {% if memo_search['montant_choice'] is defined and memo_search['montant_choice'] == "eq" %} selected {% endif %} >
                                        Egal à
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-6">
                                {% if  app.session.flashbag.has('error_montant_don') %}
                                    {# Affichage des erreurs pour ce champ précis. #}
                                    <div class="form-group has-error">
                                        <label class="control-label" for="inputError">
                                            {% for flashMessage in app.session.flashbag.get('error_montant_don') %}
                                                <li>{{ flashMessage }}</li>
                                            {% endfor %}
                                        </label>
                                        <input type="text" id="montant_don"
                                               name="montant_don"  {% if memo_search['montant_don'] is defined and memo_search['montant_don'] is not null %} value="{{ memo_search['montant_don'] }}" {% endif %}
                                               placeholder="Montant du don" class="task_field form-control ">
                                    </div>
                                {% else %}
                                    <input type="text" id="montant_don"
                                           name="montant_don"  {% if memo_search['montant_don'] is defined and memo_search['montant_don'] is not null %} value="{{ memo_search['montant_don'] }}" {% endif %}
                                           placeholder="Montant du don" class="task_field form-control ">
                                {% endif %}
                            </div>
                        </div>
                        <div class="row" style="  margin-left: 10px;">
                            <div class="form-group col-md-12">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox"
                                               name="d_inactif" {% if memo_search['d_inactif'] is defined and memo_search['d_inactif'] is not null %} checked="checked" {% endif %} ><b>Dons
                                            inactifs</b>
                                    </label>
                                </div>
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox"
                                               name="d_actif" {% if memo_search['d_actif'] is defined and memo_search['d_actif'] is not null %} checked="checked" {% endif %} ><b>Dons
                                            actifs</b>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.span -->

        <div class="col-xs-12 col-sm-4">
            <div class="widget-box">
                <div class="widget-header">
                    <h4 class="widget-title title-plus">Paiement</h4>

                </div>

                <div class="widget-body">
                    <div class="widget-main">
                        <div class="row">
                            <div class="col-md-12">
                                <label for="iban"><label for="iban" class="required">Mode de paiement</label></label>
                                <select name="mode_paiement" class="task_field form-control ">
                                    <option value=""></option>
                                    {% for mode in modes %}
                                        <option value="{{ mode.codeSolution }}"  {% if memo_search['mode_paiement'] is defined and memo_search['mode_paiement'] == mode.codeSolution %} selected {% endif %} >{{ mode.libelle }}</option>
                                    {% endfor %}
                                </select>
                                <br/>
                            </div>

                        </div>
                        <div class="row">
                            <div class=" col-md-12">
                                <label for="iban"><label for="iban" class="required">IBAN</label></label>
                                <input type="text" name="iban"
                                       placeholder="Iban" {% if memo_search['iban'] is defined and memo_search['iban'] is not null %} value="{{ memo_search['iban'] }}" {% endif %}
                                       class="task_field form-control "/>
                                <br/>
                            </div>


                        </div>
                        <div class="row">
                            <div class="col-md-12">
                                <label for="iban"><label for="iban" class="required">Numéro de chèque</label></label>
                                {% if  app.session.flashbag.has('error_num_cheque') %}
                                    {# Affichage des erreurs pour ce champ précis. #}
                                    <div class="form-group has-error">
                                        <label class="control-label" for="inputError">
                                            {% for flashMessage in app.session.flashbag.get('error_num_cheque') %}
                                                <li>{{ flashMessage }}</li>
                                            {% endfor %}
                                        </label>
                                        <input type="text" id="num_cheque"
                                               name="num_cheque" {% if memo_search['num_cheque'] is defined and memo_search['num_cheque'] is not null %} value="{{ memo_search['num_cheque'] }}" {% endif %}
                                               placeholder="Numéro du chèque" class="task_field form-control ">
                                    </div>
                                {% else %}
                                    <input type="text" id="num_cheque"
                                           name="num_cheque"  {% if memo_search['num_cheque'] is defined and memo_search['num_cheque'] is not null %} value="{{ memo_search['num_cheque'] }}" {% endif %}
                                           placeholder="Numéro du chèque" class="task_field form-control ">
                                {% endif %}
                                <br/>
                            </div>

                        </div>

                        <!-- /section:plugins/input.chosen -->
                    </div>
                </div>
            </div>
        </div>
        <!-- /.span -->
        </div>

        </form>
        </div>
        <div class="tab-pane {% if result is not empty %}active{% endif %} " id="result">
            <br/>

            <div class="miftah">
                <div class="element"
                     style="background-color: #dff0d8;float:left;margin-right:5px;border: 1px solid #000;"></div>
                <div style="float:left;margin-right:10px;">Dons validés</div>
                <div class="element"
                     style="background-color: #fcf8e3;float:left;margin-right:5px;border: 1px solid #000;"></div>
                <div style="float:left;margin-right:10px;">Dons en attente</div>
                <div class="element"
                     style="background-color: #f2dede;float:left;margin-right:5px;border: 1px solid #000;"></div>
                <div style="float:left;margin-right:10px;">Dons annulés</div>
                <br/>
            </div>
            <table class="table table-condensed">
                <thead>
                <tr>
                    <th>#REF</th>
                    <th>Montant</th>
                    <th>Nom/Prénom</th>
                    <th>Activité/Occasion</th>
                    <th>Date de création</th>
                    <th>Etat</th>
                    <th>Mode de paiement</th>
                    <th>Type de don</th>
                    <th></th>
                </tr>
                </thead>
                <tbody id="content">
                {% for r in result %}
                    <tr {% if r.transaction.statut.code is defined %}
                        {% if r.transaction.statut.code == "paiement_annule" or r.removed == 1 %}class="danger"{% endif %}
                        {% if r.transaction.statut.code == "attente" %}class="warning"{% endif %}
                        {% if r.transaction.statut.code == "traitement_paiement" %}class="alert-info"{% endif %}
                        {% if r.transaction.statut.code == "don_valide" %}class="success"{% endif %}

                    {% else %}
                        class="danger"
                            {% endif %}>
                        <td>{{ r.id }}</td>
                        <td>{{ r.montant|round(2, 'floor') }} €</td>
                        <td>
                            {% set donateur_ix = r.user.id|donateur %}
                            {% if donateur_ix is not null %}
                                {{ donateur_ix.nom }} / {{ donateur_ix.prenom }}
                            {% endif %}
                        </td>


                        <td>
                            {% if r.cause is not null %}{{ r.cause.code }}{% endif %}
                            / {% if r.cause is not null %}{{ r.cause.codeOccasion.code }}{% endif %}</td>
                        <td>{{ r.createdAt | date('Y-m-d H:i:s') }}</td>
                        <td>{% if r.transaction.statut.libelle is defined %}{{ r.transaction.statut.libelle }}{% else %}Abondonné{% endif %}</td>
                        <td>{% if r.modePaiement is defined and  r.modePaiement is not null %}{{ r.modePaiement.libelle }}{% endif %}</td>
                        <td>
                            {% if r.ispa %}
                                régulier
                            {% else %}
                                ponctuel
                            {% endif %}
                        </td>
                        <td><a href="{{ path('intersa_dons_view',{'id':r.id}) }}" class="btn btn-default btn-xs"><span
                                        class="glyphicon glyphicon-wrench"></span>&nbsp; Gestion</a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            <center>
                {% if last_page > 1 %}
                    <ul class="pagination pull-center">
                        <li><a href="{{ path('intersa_dons') }}?{{ params }}&page={{ previous_page }}">&laquo;</a></li>
                        {% for page in 1..last_page %}
                            {% if page >= current_page-4 and page <= current_page+4 %}
                                {% if   page == current_page-4 or page == current_page+4 %}
                                    {% if   page == current_page-4 %}
                                        <li><a href="{{ path('intersa_dons') }}?{{ params }}&page=1">1</a></li>
                                        <li class="disabled"><a href="#">...</a></li>
                                    {% else %}
                                        <li class="disabled"><a href="#">...</a></li>
                                        <li>
                                            <a href="{{ path('intersa_dons') }}?{{ params }}&page={{ last_page }}">{{ last_page }}</a>
                                        </li>
                                    {% endif %}
                                {% else %}
                                    {% if page == current_page %}
                                        <li class="active"><a href="#">{{ page }}</a></li>
                                    {% else %}
                                        <li>
                                            <a href="{{ path('intersa_dons') }}?{{ params }}&page={{ page }}">{{ page }}</a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                            {% endif %}
                        {% endfor %}
                        <li><a href="{{ path('intersa_dons') }}?{{ params }}&page={{ next_page }}">&raquo;</a></li>
                    </ul>
                {% endif %}
            </center>
        </div>
        </div>
        </div>
        <div class="modal fade" id="addRecherche" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="myModalLabel">Ajouter cette recherche aux favoris</h4>
                    </div>
                    <form action="{{ path('intersa_donateur_favoris_add', {'section': 'dons'}) }}" method="POST">
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-12">
                                    <label class=" control-label">Titre de la recherche</label>
                                    <input class="form-control" name="title" required="required"/>
                                    <br/>
                                    <label class=" control-label">Description de la recherche</label>
                                    <textarea name="description" class="form-control"></textarea>

                                    <input id="url" class="form-control" name="url" required="required" type="hidden"
                                           value="{{ params }}" readonly="readonly"/>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal">Annuler</button>
                            <button type="submit" class="btn btn-primary">Sauvegarder la recherche</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal fade" id="listRecherche" tabindex="-1" role="dialog" aria-labelledby="listRecherche"
             aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                                    aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title" id="listRechercheLabel">Liste des favoris</h4>
                    </div>

                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12">
                                <table class="table table-hover">
                                    <thead>
                                    <th>Informations sur la recherche</th>
                                    <th>Actions</th>
                                    </thead>
                                    <tbody>
                                    {% for f in favoris %}
                                        <tr>
                                            <td>{{ f.title }}<br/><span
                                                        style="font-size: 10px;">{{ f.description }}</span></td>
                                            <td>
                                                <div class="btn-group">
                                                    <button type="button" class="btn btn-xs btn-default dropdown-toggle"
                                                            data-toggle="dropdown" aria-expanded="false">
                                                        Actions <span class="caret"></span>
                                                    </button>
                                                    <ul class="dropdown-menu" role="menu">
                                                        <li><a href="{{ path('intersa_dons') }}?{{ f.url }}"
                                                               target="_blank"><i class="fa fa-search"></i> Lancer la
                                                                recherche</a></li>
                                                        <li>
                                                            <a href="{{ path('intersa_donateur_favoris_delete', {'id': f.id}) }}"><i
                                                                        class="fa fa-trash-o"></i> Supprimer la
                                                                recherche</a></li>
                                                    </ul>
                                                </div>
                                            </td>
                                        </tr>
                                    {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    </form>
                </div>
            </div>
        </div>
        </div>
    {% endblock %}

    {% block javascripts %}
        {{ parent() }}
        <script>
            var $inputCause = $('#cause');
            var $inputOccasion = $('#code_occasion');
            var $inputCampagne = $('#code_campagne');

            //causes
            $.ajax({
                url: "/intersa/causes",
                beforeSend: function (xhr) {
                    ;
                }
            })
                    .done(function (data) {
                        if (data.length != 0) {

                            $inputCause.typeahead({source: data,
                                autoSelect: true});
                        }

                    });
            //occasions
            $.ajax({
                url: "/intersa/occasions" ,
                beforeSend: function( xhr ) {
                    ;
                }
            })
                    .done(function( data ) {
                        if(data.length != 0) {

                            $inputOccasion.typeahead({source:data,
                                autoSelect: true});
                        }

                    });
            //campagne
            $.ajax({
                url: "/intersa/campagnes" ,
                beforeSend: function( xhr ) {
                    ;
                }
            })
                    .done(function( data ) {
                        if(data.length != 0) {

                            $inputCampagne.typeahead({source:data,
                                autoSelect: true});
                        }

                    });


            $inputCause.change(function () {
                console.log('test');
                var current = $inputCause.typeahead("getActive");
                if (current) {
                    // Some item from your model is active!
                    if (current.name == $inputCause.val()) {
                        // This means the exact match is found. Use toLwerCase() if you want case insensitive match.
                    } else {
                        // This means it is only a partial match, you can either add a new item
                        // or take the active if you don't want new items
                    }
                } else {
                    // Nothing is active so it is a new value (or maybe empty value)
                }
            });

            $inputOccasion.change(function () {
                console.log('test');
                var current = $inputOccasion.typeahead("getActive");
                if (current) {
                    // Some item from your model is active!
                    if (current.name == $inputOccasion.val()) {
                        // This means the exact match is found. Use toLwerCase() if you want case insensitive match.
                    } else {
                        // This means it is only a partial match, you can either add a new item
                        // or take the active if you don't want new items
                    }
                } else {
                    // Nothing is active so it is a new value (or maybe empty value)
                }
            });


            $inputCampagne.change(function () {
                console.log('test');
                var current = $inputCampagne.typeahead("getActive");
                if (current) {
                    // Some item from your model is active!
                    if (current.name == $inputCampagne.val()) {
                        // This means the exact match is found. Use toLwerCase() if you want case insensitive match.
                    } else {
                        // This means it is only a partial match, you can either add a new item
                        // or take the active if you don't want new items
                    }
                } else {
                    // Nothing is active so it is a new value (or maybe empty value)
                }
            });

            $('#fulldon_donateurbundle_dontype_abonnement_actif').on('click', function () {
                if ($('#fulldon_donateurbundle_dontype_abonnement_actif').is(':checked')) {
                    $('#abo_date').show();
                } else {
                    $('#abo_date').hide();
                }
            });
            $(document).ready(function () {
                $("div.holder").jPages({
                    containerID: "content",
                    perPage: 10
                });
            });

        </script>
    {% endblock %}